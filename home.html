<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
    <title>Grub Crawl</title>
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="content/css/grubgrawl/main.css">
    <link rel="stylesheet" href="content/css/jquery-ui.css">
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="header__container container">
            <div class="header__row row">
                <!-- NAVIGATION -->
                <nav class="header__navigation container text-right">
                    <!-- MOBILE MENU -->
                    <a href="#" class="header__mobile-navigation burger" id="burger" data-toggle="collapse" data-target="#menu"></a>
                    <!-- MOBILE MENU END -->
                    <!-- GENERAL MENU -->

                    <a href="/">
                        <img src="content/img/grubgrawl/header/header__logo.png" class="header__logo-img" alt="Grub Crawl logo">
                    </a>

                    <a href="http://grubcrawl.com/#ot_header" target="_blank" class="header__navigation subscribe">Subscribe</a>

                    <ul class="header__desktop-navigation list-inline list-unstyled" id="menu">
                        <li><a href="http://grubcrawl.com/#private_event" target="_blank">Private Request</a></li>
                        <li><a href="http://grubcrawl.com/#partnership" target="_blank">Partnerships</a></li>
                        <!--
                        <li><a href="#" class="cart"><span></span></a></li>
                        -->
                    </ul>
                    <!-- GENERAL MENU END -->
                </nav>
                <!-- NAVIGATION END -->
            </div>
            <div class="header__row header__search row text-center">
                <div class="header__form col-md-12">
                    <div class="row">
                        <div class="header__logo col-md-12">
                            <a href="/">
                                <img src="content/img/grubgrawl/header/header__logo.png" alt="Grub Crawl logo">
                            </a>
                        </div>
                        <form class="col-md-12" onsubmit="search(); return false;">
                            <fieldset>
                                <input type="text" id="term" name="searchTerm" placeholder="Search location, city, event, etc." />
                                <input type="text" id="fromDate" name="fromDate" placeholder="From Date" />
                                <input type="text" id="toDate" name="toDate" placeholder="To Date" />
                                <button type="submit" class="btn">Search</button>
                            </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- HEADER END -->

    <!-- MAIN -->
    <main class="main">
        <!-- EVENTS -->
        <section class="events text-center">
            <div class="events__container container">
                <div class="events__heading events__row row">
                    <div class="col-md-12">
                        <h1>SF BAY AREA EVENTS</h1>
                    </div>
                </div>
                <div id="search-result">
                    <div class="events-list">
                        
                    </div>
                    <div class="events__row row">
                        <div class="col-md-12">
                            <a href="javascript:void(0)" id="show-more" class="btn btn--default btn--big" onclick="showMore(); return false;">Show more</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- EVENTS END -->
        <section class="promo">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 promo__text">
                        <p>Are you an Experience Provider?</p>
                        <a href="http://grubcrawl.com/#partnership" target="_blank" class="btn btn--primary">Learn About Partnerships</a>
                    </div>
                    <div class="col-md-6 promo__img"><img src="content/img/grubgrawl/img2.png" alt="" /></div>
                </div>
                <div class="row">
                    <div class="col-md-6 promo__img"><img src="content/img/grubgrawl/img1.png" alt="" /></div>
                    <div class="col-md-6 promo__text">
                        <p>Do you want Private or Corporate Experience?</p>
                        <a href="http://grubcrawl.com/#private_event" target="_blank" class="btn btn--primary">Learn About Private Requests</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script id="events-list-template" type="x-tmpl-mustache">
        <div class="events__catalog events__row row">
            {{#Items}}
            <a href="/Details/{{Id}}" class="undecorated" title="{{Title}}">
                <div class="col-md-4">
                    <article class="events__item">
                        <header class="events__header">
                            <img src="{{ImageUrl}}" alt="events-item">
                        </header>
                        <div class="events__content">
                            <h1>{{Title}}</h1>
                            <ul class="events__information list-unstyled row">
                                <li class="events__duration col-xs-12">{{Duration}}</li>
                            </ul>
                        </div>
                        <div class="events__price">{{PriceRange}}</div>
                        <footer class="events__footer">
                            <a href="/Details/{{Id}}" class="btn btn-block btn--primary">Book now</a>
                        </footer>
                    </article>
                </div>
            </a>
            {{/Items}}
        </div>
    </script>

    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center">
                    <nav class="footer__navigation">
                        <ul class="list-inline list-unstyled">
                            <li><a href="http://grubcrawl.com/#private_event" target="_blank">Private Request</a></li>
                            <li><a href="http://grubcrawl.com/#partnership" target="_blank">Partnerships</a></li>
                            <li><a href="/Terms">Terms</a></li>
                            <li><a href="/Privacy">Privacy</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="row">
                <div class="footer__copyright col-md-4">
                    <span>&copy; 2017. All Rights Reserved.</span>
                </div>
                <div class="footer__logo col-md-4 text-center">
                    <a href="/">
                        <img src="content/img/grubgrawl/header/header__logo.png" alt="Grub Crawl logo" style="width: 92px;">
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script src="content/js/jquery-1.9.1.min.js"></script>
    <script src="content/js/jquery-ui-1.11.3.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>

    <script>
        $("#toDate").datepicker();
        $("#fromDate").datepicker();

        var loadedEvents = 0;
        var isSearch = false;
        var header = $('header.header');
        var eventsListTemplate = $("#events-list-template").html();
        var eventsListMoreTemplate = $("#events-list-more-template");

        Mustache.parse(eventsListTemplate);

        window.addEventListener("scroll",
            function() {
                toggleFixedHeader();
            });

        $(function () {
            toggleFixedHeader();
            loadEvents(null, "featured", null);
        });

        function toggleFixedHeader() {
            header.toggleClass("fixed", window.outerWidth > 990 && window.scrollY > 450);
        }

        function search() {
            isSearch = true;
            clearLoadedEvents();
            loadEvents(6);
        }

        function showMore() {
            loadEvents(6, null, isSearch ? null : "featured");
        }

        function loadEvents(take, tag, excludeTag) {
            var data = {
                skip: loadedEvents,
                take: take,
                searchTerm: $("#term").val(),
                from: $("#fromDate").val(),
                to: $("#toDate").val(),
                tag: tag,
                excludeTag: excludeTag
            };


            $.get('/brand/events', data, function (list) {
                var html = Mustache.render(eventsListTemplate, list);

                $("#search-result .events-list").append(html);
                $("#show-more").toggle(!list.IsLastPage);

                loadedEvents += list.Items.length;
            });
        }

        function clearLoadedEvents() {
            loadedEvents = 0;
            $("#search-result .events-list").html('');
        }
    </script>
</body>
</html>